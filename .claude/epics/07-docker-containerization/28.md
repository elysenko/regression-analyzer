---
name: Create multi-stage Dockerfile
status: open
created: 2026-01-20T20:45:46Z
updated: 2026-01-20T20:47:16Z
github: https://github.com/elysenko/regression-analyzer/issues/28
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Create multi-stage Dockerfile

## Description

Create a production-ready Dockerfile using multi-stage builds to minimize image size. The Dockerfile should build the Python wheel in a build stage and install only the runtime dependencies in the final image.

## Acceptance Criteria

- [ ] Multi-stage Dockerfile created with build and runtime stages
- [ ] Uses python:3.11-slim as base image
- [ ] Builds wheel using hatchling from pyproject.toml
- [ ] Creates non-root user (appuser, UID 1000)
- [ ] Includes health check instruction
- [ ] Configures uvicorn as entrypoint
- [ ] Exposes port 8000

## Technical Details

- Build stage: Install hatchling, build wheel from pyproject.toml
- Runtime stage: Copy wheel, install with api extras, create user
- Entry point: `uvicorn regression_analyzer.api.main:app --host 0.0.0.0 --port 8000`
- Health check: curl against /api/v1/health endpoint
- Install curl in runtime stage for health check

### Files to Create
- `Dockerfile` in repository root

## Dependencies

- [ ] pyproject.toml exists with api extras defined
- [ ] src/regression_analyzer/api/main.py exists

## Effort Estimate

- Size: S
- Hours: 1
- Parallel: true

## Definition of Done

- [ ] Dockerfile created in repository root
- [ ] Multi-stage build structure verified
- [ ] Non-root user configured
- [ ] Health check instruction present
