---
name: Add analyze and results endpoints
status: open
created: 2026-01-20T20:36:31Z
updated: 2026-01-20T20:39:01Z
github: https://github.com/elysenko/regression-analyzer/issues/24
depends_on: [22, 23]
parallel: false
conflicts_with: []
---

# Task: Add analyze and results endpoints

## Description

Add the core analysis endpoints that trigger the AnalysisPipeline on uploaded files and retrieve results.

## Acceptance Criteria

- [ ] POST /api/v1/analyze triggers analysis on uploaded file
- [ ] Supports all options: target, context, skip_llm
- [ ] Returns job_id for tracking
- [ ] GET /api/v1/results/{job_id} returns analysis results
- [ ] Results include statistics, chart names, warnings
- [ ] Proper error handling for missing uploads/jobs

## Technical Details

### Analyze Endpoint
```python
@app.post("/api/v1/analyze", response_model=JobResponse)
async def analyze(request: AnalyzeRequest):
    # Validate upload_id exists
    upload_path = storage.get_upload_path(request.upload_id)
    if not upload_path.exists():
        raise HTTPException(404, "Upload not found")

    # Generate job_id
    job_id = str(uuid.uuid4())

    # Create pipeline and run analysis
    pipeline = AnalysisPipeline(
        output_dir=storage.get_job_dir(job_id),
        use_llm=not request.skip_llm
    )

    await pipeline.load_data(str(upload_path))

    if not request.skip_llm:
        await pipeline.check_transpose()
        await pipeline.identify_context(request.context)
        await pipeline.analyze_columns()

    await pipeline.run_statistics(target=request.target)
    await pipeline.generate_charts()

    # Get result and save
    result = pipeline.get_result()
    storage.save_result(job_id, result.to_dict())

    return JobResponse(job_id=job_id, status="completed")
```

### Results Endpoint
```python
@app.get("/api/v1/results/{job_id}")
async def get_results(job_id: str):
    result = storage.get_result(job_id)
    if result is None:
        raise HTTPException(404, "Job not found")
    return result
```

### Error Handling
- 404: Upload or job not found
- 400: Invalid request parameters
- 500: Pipeline execution error (with details)

## Dependencies

- [ ] Task 001: Models and storage
- [ ] Task 002: FastAPI app foundation

## Effort Estimate

- Size: M
- Hours: 3-4
- Parallel: false (depends on 001, 002)

## Definition of Done

- [ ] Analyze endpoint functional
- [ ] Results endpoint returns proper JSON
- [ ] Error cases handled gracefully
- [ ] Pipeline integration verified
